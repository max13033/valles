(function(){if(window.BXMailMessageActions)return;var e={};e.init=function(e){var n=this;n.options=e;var t=n.createAction.bind(n);var a=BX("mail-msg-"+n.options.messageId+"-actions-create-btn");BX.bind(a,"click",function(e){t(e,{value:n.options.createMenu.__default.id,disable:BX.addClass.bind(BX,a.parentNode,"ui-btn-main-disabled"),enable:BX.removeClass.bind(BX,a.parentNode,"ui-btn-main-disabled")})});var i=BX("mail-msg-"+n.options.messageId+"-actions-create-menu-btn");BX.bind(i,"click",function(){var e=["TASKS_TASK"];if(n.options.isCrmEnabled){e.push(n.options.createMenu["CRM_ACTIVITY"].binded?"CRM_EXCLUDE":"CRM_ACTIVITY")}e=e.concat(["BLOG_POST","IM_CHAT","CALENDAR_EVENT"]);for(var a=0,o;a<e.length;a++){o=e[a];if(o==n.options.createMenu.__default.id){e.splice(a,1);a--;continue}e[a]={text:n.options.createMenu[o].title,value:n.options.createMenu[o].id,onclick:t,disabled:n.options.createMenu[o].disabled}}BX.Main.MenuManager.show("mail-msg-"+n.options.messageId+"-create-menu",i,e,{offsetLeft:16,angle:true,closeByEsc:true})})};e.createAction=function(e,n){var t=this;var a=function(e){n.enable();if(e.errors&&e.errors.length>0){var t=e.errors.map(function(e){return e.message}).join("<br>");top.BX.UI.Notification.Center.notify({autoHideDelay:5e3,content:t})}};switch(n.value){case"TASKS_TASK":top.BX.SidePanel.Instance.open(t.options.createMenu["TASKS_TASK"].href);break;case"CRM_ACTIVITY":n.disable();var i=BX.ajax.runComponentAction("bitrix:mail.client","createCrmActivity",{mode:"ajax",data:{messageId:t.options.messageId}});i.then(function(e){n.enable();top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_ACTIONS_NOTIFY_ADDED_TO_CRM")});t.options.createMenu["CRM_ACTIVITY"].binded=true;BX.Main.MenuManager.destroy("mail-msg-"+t.options.messageId+"-create-menu");BX.Event.EventEmitter.emit("BXMailMessageActions:CRM_ACTIVITY",{messageId:t.options.messageId})},a);break;case"CRM_EXCLUDE":n.disable();var o=n.messageId||t.options.messageId;var i=BX.ajax.runComponentAction("bitrix:mail.client","removeCrmActivity",{mode:"ajax",data:{messageId:o}});i.then(function(e){top.BX.UI.Notification.Center.notify({autoHideDelay:2e3,content:BX.message("MAIL_MESSAGE_ACTIONS_NOTIFY_EXCLUDED_FROM_CRM")});BX.Event.EventEmitter.emit("BXMailMessageActions:CRM_EXCLUDE",{messageId:t.options.messageId});n.enable();if(o==t.options.messageId){t.options.createMenu["CRM_ACTIVITY"].binded=false}BX.Main.MenuManager.destroy("mail-msg-"+t.options.messageId+"-create-menu")},a);break}if(n.menuWindow){n.menuWindow.close()}};window.BXMailMessageActions=e})();
//# sourceMappingURL=script.map.js